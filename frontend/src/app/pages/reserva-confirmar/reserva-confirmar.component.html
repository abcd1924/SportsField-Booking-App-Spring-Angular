<div class="min-h-screen bg-gray-50 py-8 px-4">
  <div class="max-w-4xl mx-auto">

    <!-- Loading State -->
    <div *ngIf="cargando" class="flex justify-center items-center py-20">
      <p-progressSpinner></p-progressSpinner>
    </div>

    <!-- Reserva Expirada -->
    <p-card *ngIf="reservaExpirada" styleClass="mb-4">
      <div class="text-center py-8">
        <i class="pi pi-clock text-6xl text-red-500 mb-4"></i>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Tiempo Agotado</h2>
        <p class="text-gray-600 mb-4">El tiempo para confirmar esta reserva ha expirado.</p>
        <p class="text-sm text-gray-500">Serás redirigido automáticamente...</p>
      </div>
    </p-card>

    <!-- Contenido Principal -->
    <div *ngIf="reserva && !cargando && !reservaExpirada">

      <!-- Timer Card -->
      <p-card styleClass="mb-6 border-2 border-orange-500">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <i class="pi pi-clock text-4xl" [ngClass]="timerColor"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Tiempo restante para confirmar</p>
              <p class="text-3xl font-bold" [ngClass]="[timerColor, tiempoRestanteSegundos < 60 ? 'timer-pulse' : '']">
                {{ timerFormateado }}</p>
            </div>
          </div>
          <p-tag value="TEMPORAL" severity="warn" styleClass="text-lg px-4 py-2"></p-tag>
        </div>
      </p-card>

      <!-- Título -->
      <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Confirmar Reserva</h1>
        <p class="text-gray-600">Revisa los detalles de tu reserva antes de confirmar</p>
      </div>

      <!-- Datos del Cliente -->
      <p-card styleClass="mb-6">
        <ng-template pTemplate="header">
          <div class="p-4 bg-blue-50 border-b border-blue-200">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="pi pi-user text-blue-600"></i>
              Datos del Cliente
            </h2>
          </div>
        </ng-template>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="flex items-start gap-3">
            <i class="pi pi-user text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Nombre Completo</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ reserva.usuario.nombre }} {{ reserva.usuario.apellido }}
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-envelope text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Correo Electrónico</p>
              <p class="text-lg font-semibold text-gray-800">{{ reserva.usuario.email }}</p>
            </div>
          </div>

          <div class="flex items-start gap-3" *ngIf="reserva.usuario.telefono">
            <i class="pi pi-phone text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Teléfono</p>
              <p class="text-lg font-semibold text-gray-800">{{ reserva.usuario.telefono }}</p>
            </div>
          </div>
        </div>

        <p-divider></p-divider>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
          <p class="text-sm text-blue-800 flex items-start gap-2">
            <i class="pi pi-info-circle mt-0.5"></i>
            <span>El comprobante será enviado a tu correo electrónico después de confirmar la reserva.</span>
          </p>
        </div>
      </p-card>

      <!-- Detalles de la Cancha -->
      <p-card styleClass="mb-6">
        <ng-template pTemplate="header">
          <div class="p-4 bg-green-50 border-b border-green-200">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="pi pi-building text-green-600"></i>
              Detalles de la Cancha
            </h2>
          </div>
        </ng-template>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="flex items-start gap-3">
            <i class="pi pi-tag text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Tipo de Cancha</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ reserva.canchaDeportiva.tipoCancha }}
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-hashtag text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Número de Cancha</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ reserva.canchaDeportiva.numeroCancha }}
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-users text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Capacidad</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ reserva.canchaDeportiva.capacidadJugadores }} jugadores
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-sun text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Tipo de Grass</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ reserva.canchaDeportiva.tipoGrass }}
              </p>
            </div>
          </div>
        </div>

        <div *ngIf="reserva.canchaDeportiva.descripcion" class="mt-4">
          <p class="text-sm text-gray-600 mb-2">Descripción</p>
          <p class="text-gray-800">{{ reserva.canchaDeportiva.descripcion }}</p>
        </div>
      </p-card>

      <!-- Detalles de la Reserva -->
      <p-card styleClass="mb-6">
        <ng-template pTemplate="header">
          <div class="p-4 bg-purple-50 border-b border-purple-200">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="pi pi-calendar text-purple-600"></i>
              Detalles de la Reserva
            </h2>
          </div>
        </ng-template>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="flex items-start gap-3">
            <i class="pi pi-calendar text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Fecha de Reserva</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ formatearFecha(reserva.fechaInicio) }}
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-clock text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Horario</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ formatearHora(reserva.fechaInicio) }} - {{ formatearHora(reserva.fechaFin) }}
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-hourglass text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Duración</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ reserva.horasTotales }} hora(s)
              </p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-dollar text-gray-400 mt-1"></i>
            <div>
              <p class="text-sm text-gray-600 mb-1">Precio por Hora</p>
              <p class="text-lg font-semibold text-gray-800">
                {{ formatearMonto(reserva.canchaDeportiva.precioPorHora) }}
              </p>
            </div>
          </div>
        </div>
      </p-card>

      <!-- Resumen de Costos -->
      <p-card styleClass="mb-6 border-2 border-gray-300">
        <ng-template pTemplate="header">
          <div class="p-4 bg-gray-100 border-b border-gray-300">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="pi pi-wallet text-gray-700"></i>
              Resumen de Costos
            </h2>
          </div>
        </ng-template>

        <div class="space-y-3">
          <div class="flex justify-between items-center pb-2">
            <span class="text-gray-600">Precio por hora:</span>
            <span class="text-lg text-gray-800">
              {{ formatearMonto(reserva.canchaDeportiva.precioPorHora) }}
            </span>
          </div>

          <div class="flex justify-between items-center pb-2">
            <span class="text-gray-600">Horas reservadas:</span>
            <span class="text-lg text-gray-800">{{ reserva.horasTotales }}</span>
          </div>

          <p-divider></p-divider>

          <div class="flex justify-between items-center">
            <span class="text-xl font-bold text-gray-800">Total a Pagar:</span>
            <span class="text-3xl font-bold text-green-600">
              {{ formatearMonto(precioTotal) }}
            </span>
          </div>
        </div>

        <p-divider></p-divider>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
          <p class="text-sm text-yellow-800 flex items-start gap-2">
            <i class="pi pi-exclamation-triangle mt-0.5"></i>
            <span>El pago se realizará en el establecimiento al momento de tu llegada.</span>
          </p>
        </div>
      </p-card>

      <!-- Información Importante -->
      <p-card styleClass="mb-6 bg-blue-50">
        <div class="space-y-3">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="pi pi-info-circle text-blue-600"></i>
            Información Importante
          </h3>

          <div class="flex items-start gap-3">
            <i class="pi pi-check-circle text-green-500 mt-1"></i>
            <p class="text-gray-700">Llegue 15 minutos antes de su horario reservado</p>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-check-circle text-green-500 mt-1"></i>
            <p class="text-gray-700">Presente su comprobante al momento de su llegada</p>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-check-circle text-green-500 mt-1"></i>
            <p class="text-gray-700">Para cancelaciones contactar con 48 horas de anticipación</p>
          </div>

          <div class="flex items-start gap-3">
            <i class="pi pi-check-circle text-green-500 mt-1"></i>
            <p class="text-gray-700">Recibirá su comprobante por correo electrónico</p>
          </div>
        </div>
      </p-card>

      <!-- Error State -->
      <p-message *ngIf="error && !cargando" severity="error" [text]="error" styleClass="mb-4 w-full"></p-message>

      <!-- Botones de Acción -->
      <div class="flex flex-col sm:flex-row gap-4 justify-end">
        <p-button label="Cancelar Reserva" icon="pi pi-times" severity="danger" [outlined]="true"
          styleClass="w-full sm:w-auto" (onClick)="cancelarReserva()" [disabled]="procesandoConfirmacion">
        </p-button>

        <p-button label="Confirmar Reserva" icon="pi pi-check" severity="success" styleClass="w-full sm:w-auto"
          [loading]="procesandoConfirmacion" (onClick)="confirmarReserva()">
        </p-button>
      </div>
    </div>

  </div>
</div>